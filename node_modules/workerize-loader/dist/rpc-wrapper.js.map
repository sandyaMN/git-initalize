{"version":3,"file":"rpc-wrapper.js","sources":["../src/rpc-wrapper.js"],"sourcesContent":["export default function addMethods(worker, methods) {\n\tlet c = 0;\n\tlet callbacks = {};\n\tworker.addEventListener('message', (e) => {\n\t\tlet d = e.data;\n\t\tif (d.type!=='RPC') return;\n\t\tif (d.id) {\n\t\t\tlet f = callbacks[d.id];\n\t\t\tif (f) {\n\t\t\t\tdelete callbacks[d.id];\n\t\t\t\tif (d.error) {\n\t\t\t\t\tf[1](Object.assign(Error(d.error.message), d.error));\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tf[0](d.result);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tlet evt = document.createEvent('Event');\n\t\t\tevt.initEvent(d.method, false, false);\n\t\t\tevt.data = d.params;\n\t\t\tworker.dispatchEvent(evt);\n\t\t}\n\t});\n\tmethods.forEach( method => {\n\t\tworker[method] = (...params) => new Promise( (a, b) => {\n\t\t\tlet id = ++c;\n\t\t\tcallbacks[id] = [a, b];\n\t\t\tworker.postMessage({ type: 'RPC', id, method, params });\n\t\t});\n\t});\n}\n"],"names":["addMethods","worker","methods","c","callbacks","addEventListener","e","d","data","type","id","f","error","Object","assign","Error","message","result","evt","document","createEvent","initEvent","method","params","dispatchEvent","forEach","Promise","a","b","postMessage"],"mappings":"AAAe,SAASA,UAAT,CAAoBC,MAApB,EAA4BC,OAA5B,EAAqC;MAC/CC,CAAC,GAAG,CAAR;MACIC,SAAS,GAAG,EAAhB;EACAH,MAAM,CAACI,gBAAP,CAAwB,SAAxB,YAAoCC;QAC/BC,CAAC,GAAGD,CAAC,CAACE,IAAV;QACID,CAAC,CAACE,IAAF,KAAS,KAAb,IAAoB;;QAChBF,CAAC,CAACG,EAAN,EAAU;UACLC,CAAC,GAAGP,SAAS,CAACG,CAAC,CAACG,EAAH,CAAjB;;UACIC,CAAJ,EAAO;eACCP,SAAS,CAACG,CAAC,CAACG,EAAH,CAAhB;;YACIH,CAAC,CAACK,KAAN,EAAa;UACZD,CAAC,CAAC,CAAD,CAAD,CAAKE,MAAM,CAACC,MAAP,CAAcC,KAAK,CAACR,CAAC,CAACK,KAAF,CAAQI,OAAT,CAAnB,EAAsCT,CAAC,CAACK,KAAxC,CAAL;SADD,MAGK;UACJD,CAAC,CAAC,CAAD,CAAD,CAAKJ,CAAC,CAACU,MAAP;;;KARH,MAYK;UACAC,GAAG,GAAGC,QAAQ,CAACC,WAAT,CAAqB,OAArB,CAAV;MACAF,GAAG,CAACG,SAAJ,CAAcd,CAAC,CAACe,MAAhB,EAAwB,KAAxB,EAA+B,KAA/B;MACAJ,GAAG,CAACV,IAAJ,GAAWD,CAAC,CAACgB,MAAb;MACAtB,MAAM,CAACuB,aAAP,CAAqBN,GAArB;;GAnBF;EAsBAhB,OAAO,CAACuB,OAAR,WAAiBH;IAChBrB,MAAM,CAACqB,MAAD,CAAN;;;;aAAgC,IAAII,OAAJ,WAAcC,CAAD,EAAIC,CAAJ;UACxClB,EAAE,GAAG,EAAEP,CAAX;MACAC,SAAS,CAACM,EAAD,CAAT,GAAgB,CAACiB,CAAD,EAAIC,CAAJ,CAAhB;MACA3B,MAAM,CAAC4B,WAAP,CAAmB;QAAEpB,IAAI,EAAE,KAAR;YAAeC,EAAf;gBAAmBY,MAAnB;gBAA2BC;OAA9C;KAH+B;KAAhC;GADD;;;;;"}